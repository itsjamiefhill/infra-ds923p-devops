# Homepage Dashboard Setup for Synology DS923+

This document provides detailed information about the Homepage dashboard component of the HomeLab DevOps Platform on Synology DS923+.

## Overview

Homepage is a modern, fully static, fast, and secure dashboard for your HomeLab DevOps Platform. It serves as:

- A central entry point to all platform services
- A status dashboard showing service health
- An organized catalog of available applications
- A modern and customizable user interface
- A dynamic service discovery integration with Consul

## Architecture

The platform implements Homepage as a standalone service:

- **Deployment Mode**: Single instance on Synology DS923+
- **Web Interface**: Modern, responsive UI accessible via browser
- **Integration**: Consul service discovery for dynamic service detection
- **Authentication**: Optional OIDC integration via Traefik
- **Health Checks**: Real-time service health status via Consul

## Configuration

Homepage configuration is defined in `jobs/homepage.hcl`, which is generated by the `10-deploy-homepage.sh` script. Key configuration elements include:

| Parameter | Default Value | Description |
|-----------|---------------|-------------|
| HTTP Port | 3000 | Web UI port |
| Hostname | home.homelab.local | Homepage URL |
| Theme | default | UI theme |
| Volume | homepage_data | Host volume for config persistence |
| Consul Integration | enabled | Dynamic service discovery |

## Memory Optimization for Synology DS923+

With 32GB RAM available on your system, Homepage is configured with adequate resource allocation:

```hcl
resources {
  cpu    = 200   # 0.2 cores
  memory = 512   # 512 MB RAM
}
```

This provides sufficient resources for Homepage while efficiently using your available memory.

## Service Integration

Homepage dynamically discovers services registered in Consul with the appropriate tags:

```hcl
service {
  name = "grafana"
  port = "http"
  
  tags = [
    "homepage.name=Grafana",
    "homepage.icon=grafana.png",
    "homepage.group=Monitoring",
    "homepage.description=Metrics visualization and dashboards"
  ]
}
```

These tags allow Homepage to:
1. Display the service with its proper name
2. Use the appropriate icon
3. Group services by their function
4. Show a meaningful description

## Technical Implementation

The Homepage deployment is implemented as a Nomad job with a Docker driver. Here's the job definition structure:

```hcl
job "homepage" {
  datacenters = ["dc1"]
  type = "service"

  group "dashboard" {
    count = 1

    volume "homepage_data" {
      type = "host"
      read_only = false
      source = "standard"
    }

    task "homepage" {
      driver = "docker"

      volume_mount {
        volume = "homepage_data"
        destination = "/app/config"
        read_only = false
      }

      config {
        image = "ghcr.io/gethomepage/homepage:latest"
        ports = ["http"]
      }

      # Environment variables for Consul integration
      env {
        CONSUL_URL = "http://consul.service.consul:8500"
        CONSUL_INTEGRATION = "true"
        CONSUL_SERVICE_TAG = "homepage"
      }

      # Generate initial configuration from Consul
      template {
        data = <<EOF
---
# Homepage Configuration - Generated from Consul

title: HomeLab DevOps Platform
subtitle: Infrastructure Services Dashboard

settings:
  theme: dark
  color: slate
  layout:
    Service Status: [0, 3, 2]

services:
{{- range services }}
{{- if (in .Tags "homepage.name") }}
  - group: {{ with (serviceTag .Name "homepage.group") }}{{ . }}{{ else }}Services{{ end }}
    name: {{ with (serviceTag .Name "homepage.name") }}{{ . }}{{ else }}{{ .Name }}{{ end }}
    icon: {{ with (serviceTag .Name "homepage.icon") }}{{ . }}{{ else }}server.png{{ end }}
    href: https://{{ .Name }}.homelab.local
    description: {{ with (serviceTag .Name "homepage.description") }}{{ . }}{{ else }}{{ .Name }} service{{ end }}
    server: {{ .Name }}.service.consul
    type: Consul
    container: {{ .Name }}
{{- end }}
{{- end }}
EOF
        destination = "local/homepage-config.yml"
      }

      # Initial service configuration
      template {
        data = <<EOF
---
# Service Widget Configuration

- Consul:
    url: http://consul.service.consul:8500/ui/
    widget:
      type: consul
      url: http://consul.service.consul:8500
      service_refresh: 60

- Vault:
    url: https://vault.homelab.local
    widget:
      type: vault
      url: https://vault.homelab.local
      refresh_interval: 60

- Nomad:
    url: http://nomad.service.consul:4646/ui/
    widget:
      type: nomad
      url: http://nomad.service.consul:4646
      refresh_interval: 60

- Traefik:
    url: https://traefik.homelab.local
    widget:
      type: traefik
      url: https://traefik.homelab.local
      refresh_interval: 60
EOF
        destination = "local/services.yml"
      }

      resources {
        cpu    = 200
        memory = 512
      }

      service {
        name = "homepage"
        port = "http"
        
        tags = [
          "traefik.enable=true",
          "traefik.http.routers.homepage.rule=Host(`home.homelab.local`)",
          "traefik.http.routers.homepage.tls=true",
          "homepage.name=Homepage",
          "homepage.icon=dashboard.png",
          "homepage.group=System",
          "homepage.description=Service dashboard and launcher"
        ]
        
        check {
          type     = "http"
          path     = "/"
          interval = "10s"
          timeout  = "2s"
        }
      }
    }

    network {
      port "http" {
        static = 3000
      }
    }
  }
}
```

## Consul Integration

Homepage integrates with Consul in two ways:

1. **Service Discovery**: Automatically finds services with Homepage tags
2. **Health Status**: Shows real-time health status from Consul checks

The integration uses Consul's API to query for services and their health.

## Data Persistence

Homepage configuration is persisted on the Synology NAS using a Nomad volume:
- **Volume Name**: homepage_data
- **Storage Class**: standard
- **Host Path**: `/volume1/docker/nomad/volumes/standard/homepage_data` (default)
- **Container Path**: `/app/config`

This ensures that your customizations are maintained across restarts and DSM updates.

## Custom Widgets

Homepage supports different types of service widgets:

1. **Consul Widget**: Shows service health from Consul
2. **Vault Widget**: Displays seal status and initialization state
3. **Prometheus Widget**: Shows alert status
4. **Docker Widget**: Displays container status
5. **System Widget**: Shows system resource usage

These widgets provide at-a-glance information about service health and status.

## Configuration Files

Homepage uses YAML configuration files:

### settings.yml

General settings for the dashboard:

```yaml
---
title: HomeLab DevOps Platform
subtitle: Infrastructure Services Dashboard

settings:
  theme: dark
  color: slate
  favicon: icons/favicon.png
  layout:
    Service Status: [0, 3, 2]
    Infrastructure: [0, 8, 4]
    Monitoring: [8, 16, 8]
    DevOps: [0, 16, 8]
    Applications: [8, 24, 16]
```

### services.yml

Service definitions, organized by groups:

```yaml
---
- Infrastructure:
  - Consul:
      icon: consul.png
      href: https://consul.homelab.local
      description: Service discovery and configuration
      widget:
        type: consul
        url: http://consul.service.consul:8500
        service_refresh: 60

  - Traefik:
      icon: traefik.png
      href: https://traefik.homelab.local
      description: Edge router and reverse proxy
      widget:
        type: traefik
        url: https://traefik.homelab.local
        refresh_interval: 60
        
  - Vault:
      icon: vault.png
      href: https://vault.homelab.local
      description: Secrets management
      widget:
        type: vault
        url: https://vault.homelab.local
        refresh_interval: 60

- Monitoring:
  - Grafana:
      icon: grafana.png
      href: https://grafana.homelab.local
      description: Metrics visualization and dashboards
      widget:
        type: iframe
        url: https://grafana.homelab.local/d/rYdddlPWk/node-exporter-full?orgId=1&refresh=10s&kiosk
        
  - Prometheus:
      icon: prometheus.png
      href: https://prometheus.homelab.local
      description: Metrics collection and alerting

  - Loki:
      icon: loki.png
      href: https://loki.homelab.local
      description: Log aggregation system
```

### bookmarks.yml

Bookmark links to external or internal resources:

```yaml
---
- Documentation:
  - Platform Docs:
      icon: docs.png
      href: https://github.com/your-repo/homelab-devops
      description: HomeLab DevOps Platform documentation
      
  - Consul Docs:
      icon: consul.png
      href: https://www.consul.io/docs
      description: Consul documentation
      
  - Vault Docs:
      icon: vault.png
      href: https://www.vaultproject.io/docs
      description: Vault documentation

- Tools:
  - JSON Formatter:
      icon: json.png
      href: https://jsonformatter.curiousconcept.com/
      description: Online JSON formatter and validator
      
  - Crontab Guru:
      icon: cron.png
      href: https://crontab.guru/
      description: Cron schedule expression editor
```

## Authentication

Homepage can be protected with OIDC authentication through Traefik:

```hcl
tags = [
  "traefik.http.routers.homepage.middlewares=oidc-auth@consul"
]
```

This ensures that only authenticated users can access the dashboard.

## Customization

### Themes

Homepage supports multiple themes:
- dark
- light
- auto (follows system preference)

### Colors

Available color schemes:
- slate
- gray
- zinc
- neutral
- stone
- red
- orange
- amber
- yellow
- lime
- green
- emerald
- teal
- cyan
- sky
- blue
- indigo
- violet
- purple
- fuchsia
- pink
- rose

### Custom Icons

You can add custom icons to the `/app/config/icons/` directory:

```bash
nomad alloc exec -task homepage <homepage-alloc-id> cp /path/to/icon.png /app/config/icons/
```

## Handling DSM Updates

When updating your Synology DSM:

1. Homepage will typically stop during the update
2. Configuration data will remain safe in the persistent volume
3. After the update, Homepage will restart automatically
4. Your dashboard configuration will be maintained

## Backup and Recovery

### Backing Up Configuration

To backup Homepage configuration:

```bash
# Option 1: Using Synology Hyper Backup
# Include /volume1/docker/nomad/volumes/standard/homepage_data in your backup task

# Option 2: Manual backup
# Archive configuration directory
tar -czf /volume2/backups/services/homepage_backup.tar.gz -C /volume1/docker/nomad/volumes/standard homepage_data
```

### Restoring Configuration

To restore from a backup:

```bash
# Stop Homepage
nomad job stop homepage

# Restore configuration
rm -rf /volume1/docker/nomad/volumes/standard/homepage_data/*
tar -xzf /volume2/backups/services/homepage_backup.tar.gz -C /volume1/docker/nomad/volumes/standard

# Restart Homepage
nomad job run jobs/homepage.hcl
```

## Troubleshooting

Common issues and their solutions:

1. **Blank Dashboard**:
   - Check if configuration files exist in the volume
   - Verify file permissions
   - Check Homepage container logs: `nomad alloc logs <homepage-alloc-id>`

2. **Service Discovery Issues**:
   - Verify Consul is running and accessible
   - Check if services have the correct tags
   - Test Consul API manually: `curl http://consul.service.consul:8500/v1/catalog/services`

3. **Widget Errors**:
   - Check browser console for JavaScript errors
   - Verify service URLs are correct
   - Ensure services are accessible from the Homepage container

4. **Authentication Problems**:
   - Verify OIDC configuration
   - Check Traefik middleware setup
   - Test authentication flow manually

## Success Criteria

The Homepage dashboard serves as the final validation that your HomeLab DevOps Platform is fully operational. When Homepage is displaying all services correctly, you have successfully completed the Stage 1 deployment.

## Next Steps

Congratulations! With the Homepage dashboard deployed, you have completed the core platform setup. Now you can:

1. Access all platform services through the Homepage dashboard
2. Start deploying your applications on top of this infrastructure
3. Customize the platform to better suit your specific needs
4. Implement backup procedures for your platform data
5. Consider extending the platform with additional services

This completes the documentation for the HomeLab DevOps Platform for Synology DS923+.